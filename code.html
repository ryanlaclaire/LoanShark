<!doctype html>
<html lang="en" class="h-100">

<head>
    <title>LOAN SHARK: A Coding Project By Ryan LaClaire</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">

    <link rel="stylesheet" href="/css/site.css">
    <link rel="icon" type="image/png" href="/img/favicon-32x32.png">
    <link rel="stylesheet" href="/css/prism.css">

    <script src="https://kit.fontawesome.com/5db21ba9c6.js" crossorigin="anonymous"></script>

</head>

<body class="d-flex flex-column h-100">
    <!-- ==== NAV SECTION ===-->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html"><img src="/img/LaClaireMark.svg" class="d-inline-block align-text-top" alt="LaClaire Logo" width="30" height="30"> LOAN SHARK</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="app.html">The App</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="code.html">The Code</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" target="_blank" href="https://github.com/ryanlaclaire/LoanShark">Git Repo</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" target="_blank" href="https://ryanlaclaire-portfolio.netlify.app/">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
     <!-- ==== MAIN SECTION ===-->
    <main class="flex-shrink-0">
       <div class="container py-4 px-4 mt-5">
           <h2 class="border-2 border-bottom border-dark">The Code for LOAN SHARK</h2>
        <div class="row row-cols-1 row-cols-lg-2">
            <div class="col col-lg-8">
                <pre class="line-numbers">
                    <code class="language-javascript">
                        //Get the values from the Page
                        //Start of Controller function
                        function getValues() {
                            //get values from the page
                            let loanAmount = document.getElementById("loanAmount").value;
                            let months = document.getElementById("months").value;
                            let interestRate = document.getElementById("interestRate").value;

                            //Validate data from input
                            //attempt to parse into INT
                            loanAmount = parseInt(loanAmount);
                            months = parseInt(months);
                            interestRate = parseInt(interestRate);

                            //if statement to validate data
                            if(Number.isInteger(loanAmount) && Number.isInteger(months) && Number.isInteger(interestRate)) {

                                //All is good and continue
                                // calculate Monthly Payment
                                //let monthlyPayment = monthPayment(loanAmount, months, interestRate);
                                //call loanSchedule()
                                let loanData = loanCalc(loanAmount, months, interestRate);
                                //call displayLoan()
                                displayLoan(loanData);

                            }else{
                                alert("You must enter valid numbers.")
                            }

                        }

                        //Generate amortization schedule for length of loan
                        function loanCalc(loanAmount, months, rate) {
                            //calculate monthly payment
                            let monthlyPayment = (loanAmount) * (rate/1200) / (1 - Math.pow((1 + rate/1200), -months));
                            monthlyPayment = Math.round((monthlyPayment + Number.EPSILON) * 100) / 100;

                            //create empty array
                            let loanPayments = [];
                            let month = 1;
                            let interest = Math.round(((loanAmount * (rate/1200)) + Number.EPSILON) * 100) / 100;
                            let totInterest = interest;
                            let principal = Math.round(((monthlyPayment - interest) + Number.EPSILON) * 100) / 100;
                            let balance = Math.round(((loanAmount - principal) + Number.EPSILON) * 100) / 100;
                            let loanPayment = {};

                            //we want to get all payment data for each month.
                            for (let i = 1; i <= months; i++){
                                //loops until conditions are true
                                loanPayment = {
                                    "month": month,
                                    "payment": monthlyPayment,
                                    "principal": principal,
                                    "interest": interest,
                                    "totInterest": totInterest,
                                    "balance": balance
                                };
                            
                                loanPayments.push(loanPayment);

                                if( month < months){
                                month += 1;
                                interest = Math.round(((balance * (rate/1200)) + Number.EPSILON) * 100) / 100;
                                totInterest = Math.round(((totInterest + interest) + Number.EPSILON) * 100) / 100;
                                principal = Math.round(((monthlyPayment - interest) + Number.EPSILON) * 100) / 100;
                                balance = Math.round(((balance - principal) + Number.EPSILON) * 100) / 100;
                                }
                                
                            }

                            return {
                                'totInterest': totInterest, 
                                'loanPayments': loanPayments,
                                'monthlyPayment': monthlyPayment,
                                'loanAmount': loanAmount
                            };
                        }

                        //Display or view functions
                        function displayLoan(loanData) {  

                            let totInterest = loanData.totInterest;
                            let paymentSchedule = loanData.loanPayments;
                            let principal = loanData.loanAmount;
                            let payment = loanData.monthlyPayment;

                            let totCost = principal + totInterest;
                            //Get table element
                            document.getElementById("payment").innerHTML = `$ ${payment}`;
                            document.getElementById('principal').innerHTML = `$ ${principal}`;
                            document.getElementById('totInterest').innerHTML = `$ ${totInterest}`;
                            document.getElementById('totCost').innerHTML = `$ ${totCost}`;


                            let tableBody = document.getElementById("results");
                            //clear table first to ensure correct data is displayed
                            tableBody.innerHTML = "";

                            for (let index = 0; index < paymentSchedule.length; index ++) {

                                    let tableRow = document.createElement('tr');

                                    let rowData1 = document.createElement('td');
                                    rowData1.innerHTML = paymentSchedule[index].month;
                                    let rowData2 = document.createElement('td');
                                    rowData2.innerHTML = paymentSchedule[index].payment;
                                    let rowData3 = document.createElement('td');
                                    rowData3.innerHTML = paymentSchedule[index].principal;
                                    let rowData4 = document.createElement('td');
                                    rowData4.innerHTML = paymentSchedule[index].interest;
                                    let rowData5 = document.createElement('td');
                                    rowData5.innerHTML = paymentSchedule[index].totInterest;
                                    let rowData6 = document.createElement('td');
                                    rowData6.innerHTML = paymentSchedule[index].balance;

                                    tableRow.appendChild(rowData1);
                                    tableRow.appendChild(rowData2);
                                    tableRow.appendChild(rowData3);
                                    tableRow.appendChild(rowData4);
                                    tableRow.appendChild(rowData5);
                                    tableRow.appendChild(rowData6);

                                    tableBody.appendChild(tableRow);
                                }

                        }
                    </code> 
                </pre>
            </div>
            <div class="col col-lg-4">
                <p>The Code is structured into 3 main functions. One to get the user input, one to control the logic as to what is done with it and one to display it to the screen.</p>
                <h5>GetValues</h5>
                <p>Get Values takes in the loan amount, the number of months or life of the loan and the interest rate. It then passes that data along to the Loan Calc function which controls all of the logic and gets back an object which is then passed along to the Display Loan function.</p>
                <h5>Loan Calc</h5>
                <p>This is the logic function where all the real work gets done. First thing it does is to calculate out the monthly payment of the loan. Next it creates an empty array to store all of the monthly payment data. It then sets the initial values of interest, total interest, principal and the balance. Next it loops through all of the months making the calculations for each month and pushing those values (as an object) into the array. It then takes all of the information and creates on larger object which it sends back to the Get Values function.</p>
                <h5>Display Loan</h5>
                <p>This function is for displaying the data to the page for the user to see. First it takes in the object of LoanData and breaks it into variables to be used. Next it displays the Monthly Payment, the original loan amount, the total interest you could expect to pay and the final cost of the loan. It then creates as many tables rows as there are months for the loan to show the amortization schedule of the payments over the life of the loan.</p>
            </div>
        </div>
       </div>
    </main>
     <!-- ==== FOOTER SECTION ===-->
    <footer class="footer mt-auto py-3 sticky-footer">
        <div class="container-fluid">
            <div class="row row-cols-1 row-cols-md-3 gy-2">
                <div id="copyright" class="col d-flex align-items-center justify-content-center justify-content-md-start text-light order-last order-md-first">
                    <div>
                        <span class="text-muted">&copy;2022</span> Ryan LaClaire | ryanlaclaire32@gmail.com
                    </div>
                </div>
                <div class="col d-flex align-items-center justify-content-center">
                    <img src="/img/LaClaireName.svg" alt="Ryan LaClaire Logo" height="36">
                </div>
                <div class="col d-flex justify-content-center justify-content-md-end align-items-center">
                    <div class="row">
                        <div class="col social"><a href="https://www.linkedin.com/in/ryan-laclaire/" target="_blank"><i class="fab fa-linkedin fa-2x"></i></a></div>
                        <div class="col social"><a href="https://github.com/ryanlaclaire" target="_blank"><i class="fab fa-github fa-2x"></i></a></div>
                        <div class="col social"><a href="https://twitter.com/ryanlaclaire32" target="_blank"><i class="fab fa-twitter fa-2x"></i></a></div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous">
    </script>
    <script src="/js/prism.js"></script>
    <script>
        Prism.plugins.NormalizeWhitespace.setDefaults({
            'remove-trailing': true,
            'remove-indent': true,
            'left-trim': true,
            'right-trim': true
            })
    </script>
</body>